<?xml version="1.0"?>
<launch>

  <arg name="prefix" default="b_bot_"/>
  <arg name="device" default="ur5"/>
  <arg name="sim"    default="false"/>

  <!-- Setup controller parameters. -->
  <arg name="scaled"	value="$(eval '' if sim else 'Scaled')"/>
  <arg name="frequency" value="$(eval 500 if device[-1] == 'e' else 125)"/>

  <rosparam file="$(find aist_bringup)/config/ur_robot_controller.yaml"
	    subst_value="true"/>

  <group if="$(arg sim)">
    <arg name="controllers"
	 value="$(arg prefix)scaled_pos_joint_traj_controller"/>
    <node name="$(arg prefix)controller_spawner"
	  pkg="controller_manager" type="spawner"
	  respawn="false" output="screen"
	  args="$(arg controllers)"/>
  </group>

  <group unless="$(arg sim)">
    <arg name="controllers"
	 value="$(arg prefix)scaled_pos_joint_traj_controller
		$(arg prefix)speed_scaling_state_controller
		$(arg prefix)force_torque_sensor_controller
		$(arg prefix)robot_status_controller"/>
    <node name="$(arg prefix)controller_spawner"
	  pkg="controller_manager" type="spawner"
	  respawn="false" output="screen"
	  args="$(arg controllers)"/>

    <!-- Load other controllers -->
    <arg name="stopped_controllers" value="$(arg prefix
    					   )joint_group_vel_controller"/>
    <node name="$(arg prefix)stopped_spawner"
    	  pkg="controller_manager" type="spawner"
    	  respawn="false" output="screen"
    	  args="--stopped $(arg stopped_controllers)" />

    <node name="$(arg prefix)controller_stopper"
    	  pkg="controller_stopper" type="node" respawn="false" output="screen">
      <remap from="robot_running"
    	     to="$(arg prefix)ur_hardware_interface/robot_program_running"/>
      <rosparam param="consistent_controllers" subst_value="true">
        - "$(arg prefix)speed_scaling_state_controller"
        - "$(arg prefix)force_torque_sensor_controller"
        - "$(arg prefix)robot_status_controller"
      </rosparam>
    </node>
  </group>

</launch>
